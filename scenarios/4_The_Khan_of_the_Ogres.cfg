#textdomain wesnoth-DB
#define ALL_SAVED
    [if]

        [variable]
            name=saved_ogres
            numerical_equals=2
        [/variable]

        [then]

        [modify_unit]
            [filter]
                role=rebel1,rebel2
            [/filter]
            role=rebel
        [/modify_unit]

        [message]
        speaker=Mursha
        message= _"We've freed enough ogres, now we can go home. The Supreme Leader will settle the conflict between the clans."
        [/message]
        [message]
        speaker=Bastard
        message= _"No. I want to punish the asshole."
        [/message]

        {REPLACE_SCENARIO_MUSIC siege_of_laurelmor.ogg}
        {APPEND_MUSIC battle.ogg}
        {APPEND_MUSIC loyalists.ogg}

        [scroll_to]
            x,y=39,11
        [/scroll_to]
        [delay]
        time=800
        [/delay]
        [message]
        speaker=Mursha
        message= _"Even after the war and flooding, the Dead Oak Fortress is well protected. An assault will be hard, you could die!"
        [/message]
        [message]
        speaker=Bastard
        message= _"Stop talking like Ka'ah. I am the leader here, and I will storm this fortress."
        [/message]
        [message]
        side=1
        race=ogre
        message= _"Great Khan! The ogres know how to get into the fortress!"
        [/message]
        [message]
        speaker=Bastard
        message= _"Speak."
        [/message]
        [message]
        side=1
        race=ogre
        message= _"The evil chief took the strongest ogres to work in the fortress. They open and close the heavy gates. If they see that Khan has freed us, they will open the gate for Khan!"
        [/message]
        [message]
        speaker=Bastard
        message= _"See, Mursha? The Fate paves my path."
        [/message]
        [message]
        speaker=Mursha
        message= _"Don't get ahead of yourself! If you are going to go to the assault, prepare yourself properly, gather a large army, and don't get hit by the enemy yourself."
        [/message]

        {HIGHLIGHT_IMAGE 36 14 items/gohere.png ()}
        
        [objectives]
              silent=no
                [objective]
                    description= _ "Bring 5 ogres to the gate (2 hex radius from the mark)."
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of 7 rebel ogres ($dead_ogres|/7)"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Moog"
                    condition=lose
                [/objective]
                 [objective]
                    description= _ "Death of Mursha"
                    condition=lose
                [/objective]
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                [/gold_carryover]
                delayed_variable_substitution=yes
        [/objectives] 

        {CLEAR_VARIABLE saved_ogres}   

        [set_variable]
            name=rebellion
            value=0
        [/set_variable]

        [micro_ai]
            side=2
            ai_type=simple_attack
            action=delete
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=simple_attack
            action=delete
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=simple_attack
            action=delete
        [/micro_ai]
        [/then]
        [else]
        [/else]
    [/if]
#enddef

[scenario]
    id=4_The_Khan_of_the_Ogres
    name = _ "The Khan of the Ogres"
    random_start_time=no
    experience_modifier=100
    map_data="{~add-ons/Dirty_Blood/maps/4_The_Khan_of_the_Ogres.map}"
    victory_when_enemies_defeated=no
    next_scenario=5_The_Orc_State
    carryover_percentage=40
    carryover_add=yes
    current_time=dusk

    {TURNS 36 32 30}
    {EVENTS_FOR_ABILITIES}

    {SCENARIO_MUSIC "breaking_the_chains.ogg"}
    {EXTRA_SCENARIO_MUSIC "knolls.ogg"}
    {EXTRA_SCENARIO_MUSIC "casualties_of_war.ogg"}

    {WINTER_SCHEDULE}

    [story]
        [part]
        story= _ "No trophy has ever matched the Avatar of the Hunt's tooth amulet. That's how, unexpectedly, Moog became the chief of the Cold Blood."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "The goblins expected Moog to improve their situation, for he had grown up side-by-side with them. The big orcs expected trouble, for many of them had openly despised Moog before. But Moog did not live up to anyone's expectations."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "He waited for Ka'ah and Mursha to solve the problems in the clan and didn't take any serious action. But the shamans were in no hurry. Time was running out. Rumors spread in the clan that Moog was a weak chief, just a pawn in Ka'ah's hands. Lokra fueled the anger, but no one ever appeased her or banished her. The clan was on the verge of rebellion."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "Moog needed a firm pillar of his power. Ka'ah had told him she was his pillar, but he realized he needed loyal warriors willing to spill blood for him, not an old woman."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "Fortunately, Mursha had a better understanding of the problem. She found out where to get such warriors."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "The nomadic ogres that were once defeated by the Cold Blood were now slaves to the Dead Oak Clan. The war had devastated the lands of this clan, and the chieftain was trying to solve all the problems with increasingly brutal exploitation of the slaves. An uprising was about to happen."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "Moog had some rights to the Ogre domain, both as the leader of the Cold Blood, which had defeated the main Ogre horde, and as the heir to the Khan of the Ogres. If he freed even a fraction of the Ogres, they could become his trusted guard."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
        [part]
        story= _ "Ka'ah was adamantly opposed to the idea. She forbade Moog and Mursha to start a war. The question of who was in charge of the clan came to a head. In front of all the warriors, Moog declared that he was the chief, and if he decided to start a war, then so be it. To the joyous shouts of the orcs, Moog marched into the lands of the Dead Oak..."
        {DB_BIGMAP}
        {JOURNEY_03_OLD}
        [/part]
    [/story]

    {DB_TRACK {JOURNEY_04_NEW} }

        [item]
            image="scenery/village-human-burned2.png"
            submerge=1
            visible_in_fog=no
            x=6
            y=26
        [/item]
        [item]
            image="scenery/village-human-burned3.png"
            submerge=1
            visible_in_fog=no
            x=8
            y=31
        [/item]
        [item]
            image="items/orcish-flag.png"
            submerge=1
            visible_in_fog=no
            x=17
            y=26
        [/item]
        [item]
            image="scenery/icepack-1.png"
            visible_in_fog=no
            x=21
            y=33
        [/item]
        [item]
            image="items/orcish-flag.png"
            submerge=1
            visible_in_fog=no
            x=27
            y=20
        [/item]
        [item]
            image="items/straw-bale1.png"
            submerge=1
            visible_in_fog=no
            x=29
            y=26
        [/item]
        [item]
            image="items/straw-bale2.png"
            submerge=1
            visible_in_fog=no
            x=30
            y=26
        [/item]
        [item]
            image="scenery/castle-ruins2.png"
            visible_in_fog=no
            x=35
            y=11
        [/item]
        [item]
            image="items/bonestack.png"
            submerge=1
            visible_in_fog=no
            x=35
            y=14
        [/item]
        [item]
            image="items/bonestack.png"
            submerge=1
            visible_in_fog=no
            x=37
            y=15
        [/item]
        [item]
            image="scenery/icepack-1.png"
            visible_in_fog=no
            x=37
            y=23
        [/item]
        [item]
            image="scenery/castle-ruins3.png"
            visible_in_fog=no
            x=41
            y=13
        [/item]
        [item]
            image="scenery/castle-ruins.png"
            visible_in_fog=no
            x=43
            y=11
        [/item]
        [item]
            image="scenery/icepack-1.png"
            visible_in_fog=no
            x=45
            y=2
        [/item]
        [item]
            image="items/bones.png"
            submerge=1
            visible_in_fog=no
            x=50
            y=1
        [/item]
        [item]
            image="items/bones.png"
            submerge=1
            visible_in_fog=no
            x=53
            y=6
        [/item]
        [item]
            image="scenery/tent-ruin-1.png"
            submerge=1
            visible_in_fog=no
            x=54
            y=3
        [/item]

    [side]
        controller=human
        side=1
        {GOLD 218 175 142}
        {MOOG_HARMFUL_STATS}
        team_name=bastards
        user_team_name= _ "Cold Blood Clan"
        recruit=Goblin Spearman,Wolf Rider,Orcish Archer,Murshas Apprentice,Orcish Assassin
        color=blue
        fog=no
        shroud=no
    [/side]
    [side]
        controller="ai"
        side=2
        {GOLD 100 120 150}
        {INCOME 5 10 15}
        id=Slaver_Farm
        type=Orcish Warrior
        name="Dead Oak Warden"
        recruit=Orcish Grunt,Orcish Archer
        hidden=no
        share_vision="all"
        shroud=no
        fog=no
        team_name=slavers
        user_team_name=_"Dead Oak Clan"
        color=purple

        [ai]
          [aspect]
            id=recruitment_instructions
            [facet]
              [value] 
                [limit]
                  type=Orcish Grunt
                  #ifdef EASY
                  max=1
                  #endif
                  #ifdef NORMAL
                  max=2
                  #endif
                  #ifdef HARD
                  max=3
                  #endif
                [/limit]
                [limit]
                  type=Orcish Archer
                  #ifdef EASY
                  max=1
                  #endif
                  #ifdef NORMAL
                  max=1
                  #endif
                  #ifdef HARD
                  max=2
                  #endif
                [/limit]
                [recruit]       
                  importance=0  
                [/recruit]     
              [/value]
            [/facet]
          [/aspect]
        [/ai]

        {FLAG_VARIANT wood-elvish}
    [/side]
    [side]
        controller="ai"
        side=3
        {GOLD 100 120 150}
        {INCOME 5 10 15}
        id=Slaver_Wood
        type=Orcish Warrior
        name=_"Dead Oak Warden"
        recruit=Orcish Grunt,Orcish Archer
        hidden=no
        share_vision="all"
        shroud=no
        fog=no
        team_name=slavers
        user_team_name=_"Dead Oak Clan"
        color=orange

        [ai]
          [aspect]
            id=recruitment_instructions
            [facet]
              [value] 
                [limit]
                  type=Orcish Grunt
                  #ifdef EASY
                  max=1
                  #endif
                  #ifdef NORMAL
                  max=2
                  #endif
                  #ifdef HARD
                  max=3
                  #endif
                [/limit]
                [limit]
                  type=Orcish Archer
                  #ifdef EASY
                  max=1
                  #endif
                  #ifdef NORMAL
                  max=1
                  #endif
                  #ifdef HARD
                  max=2
                  #endif
                [/limit]
                [recruit]       
                  importance=0  
                [/recruit]     
              [/value]
            [/facet]
          [/aspect]
        [/ai]

        {FLAG_VARIANT wood-elvish}

        [unit]
            id=Deputy
            type="Orcish Grunt"
            x=18
            y=13
        [/unit]
    [/side]
    [side]
        controller="ai"
        side=4
        {GOLD 17 28 40}
        #ifdef EASY
        village_gold=2
        #endif
        #ifdef NORMAL
        village_gold=2
        #endif
        #ifdef HARD
        village_gold=3
        #endif
        [ai]
            recruitment_pattern=fighter,fighter,fighter,scout,archer
            passive_leader=yes
        [/ai]
        id=Slaver_Main
        type=Orcish Warlord
        name=_"Turge the Enslaver"
        #ifdef EASY
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider
        #endif
        #ifdef NORMAL
        recruit=Orcish Grunt,Orcish Warrior,Orcish Archer,Wolf Rider
        #endif
        #ifdef HARD
        recruit=Orcish Grunt,Orcish Warrior,Orcish Archer,Orcish Crossbowman,Wolf Rider
        #endif
        hidden=no
        share_vision="all"
        shroud=no
        fog=no
        team_name=slavers
        user_team_name=_"Dead Oak Clan"
        color=brown
        {FLAG_VARIANT wood-elvish}

        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Archer" "Orcish Crossbowman"}
            role=guard
            upkeep=0
            x=32
            y=9
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Archer" "Orcish Crossbowman"}
            role=guard
            upkeep=0
            x=33
            y=10
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Crossbowman" "Orcish Crossbowman"}
            role=guard
            upkeep=0
            x=43
            y=6
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Crossbowman" "Orcish Crossbowman"}
            role=guard
            upkeep=0
            x=44
            y=8
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Crossbowman" "Orcish Slurbow"}
            role=guard
            upkeep=0
            x=45
            y=9
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Archer" "Orcish Crossbowman"}
            role=guard
            upkeep=0
            x=45
            y=11
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Archer" "Orcish Crossbowman" "Orcish Slurbow"}
            role=guard
            upkeep=0
            x=43
            y=15
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=34
            y=8
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=38
            y=5
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=35
            y=6
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=35
            y=5
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=44
            y=5
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=44
            y=6
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Warrior" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=41
            y=6
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=48
            y=9
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Warrior" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=46
            y=10
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Grunt" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=41
            y=14
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Warrior" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=43
            y=14
        [/unit]
        [unit]
            {TYPE_ON_DIFFICULTY "Orcish Grunt" "Orcish Warrior" "Orcish Warrior"}
            role=guard
            upkeep=0
            x=42
            y=14
        [/unit]
        [unit]
            type=Orcish Warrior
            role=guard
            upkeep=0
            x=34
            y=14
        [/unit]
        [unit]
            type=Orcish Warrior
            role=guard
            upkeep=0
            x=36
            y=15
        [/unit]
        [unit]
            type="Orcish Archer"
            upkeep=0
            x=36
            y=5
        [/unit]
        [unit]
            type="Orcish Archer"
            upkeep=0
            x=43
            y=12
        [/unit]
        [unit]
            type="Orcish Archer"
            upkeep=0
            x=35
            y=12
        [/unit]

        #ogres 

        [unit]
            role=treator
            type="Ogre"
            x=34
            y=12
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=40
            y=14
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=33
            y=9
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=37
            y=6
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=45
            y=10
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=42
            y=6
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=42
            y=12
        [/unit]
        [unit]
            role=treator
            type="Ogre"
            x=35
            y=11
        [/unit]
    [/side]
    [side]
        controller=ai
        side=5
        team_name=bastards
        user_team_name= _ "Slaves"
        color=teal
        no_leader=yes
        hidden=no
        share_vision=no

        #wood slaves

        [unit]
            role=rebel1
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=16
            y=10
        [/unit]
        [unit]
            role=rebel1
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=18
            y=10
        [/unit]
        [unit]
            role=rebel1
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=20
            y=9
        [/unit]
        [unit]
            role=rebel1
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=13
            y=11
        [/unit]
        [unit]
            role=rebel1
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=9
            y=11
        [/unit]
        [unit]
            role=rebel1
            id=First_Rebel
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            {TYPE_ON_DIFFICULTY "Ogre" "Young Ogre" "Young Ogre"}
            x=17
            y=12
        [/unit]
        
        #farm slaves

        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=41
            y=24
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=41
            y=27
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            {TYPE_ON_DIFFICULTY "Ogre" "Young Ogre" "Young Ogre"}
            x=37
            y=27
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=48
            y=23
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=39
            y=22
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=29
            y=31
        [/unit]
        [unit]
            role=rebel2
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            type="Young Ogre"
            x=38
            y=30
        [/unit]
    [/side]

    #prestart event - micro ais, recalls, wolves

    [event]
    name=prestart

    #zero_moves

    [store_unit]
        [filter]
            side=4
            race=orc
            canrecruit=no
        [/filter]
        variable=orc_guards
    [/store_unit]
    [store_unit]
        [filter]
            side=4
            race=ogre
        [/filter]
        variable=ogre_guards
    [/store_unit]
    [foreach]
        array=orc_guards
        index_var=i
        [do]
            [object]
                silent=yes
                duration=forever
                id=zero_moves_orcs
                take_only_once=no
            [filter]
                id=$this_item.id
            [/filter]
            [effect]
                apply_to=movement
                set=0
            [/effect]
            [/object]
        [/do]
    [/foreach]
    [foreach]
        array=ogre_guards
        index_var=i
        [do]
            [object]
                silent=yes
                duration=forever
                id=zero_moves_ogres
                take_only_once=no
            [filter]
                id=$this_item.id
            [/filter]
            [effect]
                apply_to=movement
                set=0
            [/effect]
            [/object]
        [/do]
    [/foreach]

    #variables

        [set_variable]
        name=saved_ogres
        value=0
        [/set_variable]

        [set_variable]
        name=dead_ogres
        value=0
        [/set_variable]

        [set_variable]
        name=open_cages2
        value=0
        [/set_variable]

        [set_variable]
        name=open_cages3
        value=0
        [/set_variable]

            [micro_ai]
                side=2
                ai_type=simple_attack
                action=add
                ca_score=300000
                [filter]
                    type=Orcish Grunt,Orcish Archer,Wolf
                [/filter]
                [filter_second]
                    side=5
                [/filter_second]
            [/micro_ai]
            [micro_ai]
                side=3
                ai_type=simple_attack
                action=add
                ca_score=300000
                [filter]
                    type=Orcish Grunt,Orcish Archer,Wolf
                [/filter]
                [filter_second]
                    side=5
                [/filter_second]
            [/micro_ai]
            [micro_ai]
                side=5
                ai_type=simple_attack
                action=add
                ca_score=600000
                [filter]
                    race=ogre
                [/filter]
                [filter_second]
                    side=2
                [/filter_second]
            [/micro_ai]
            [micro_ai]
                side=5
                ai_type=simple_attack
                action=add
                ca_score=600000
                [filter]
                    race=ogre
                [/filter]
                [filter_second]
                    side=3
                [/filter_second]
            [/micro_ai]
    #Mursha
            [recall]
                id=Mursha
                x,y=12,28
            [/recall]
    [/event]

    #wolves

    {WOLF_CAGE 25 31 2}
    {WOLF_CAGE 27 27 2}
    {WOLF_CAGE 32 22 2}
    {WOLF_CAGE 38 19 2}

    {WOLF_CAGE 9 17 3}
    {WOLF_CAGE 14 16 3}
    {WOLF_CAGE 23 13 3}
    {WOLF_CAGE 26 9 3}

    {WOLF_CAGE 38 11 4}
    {WOLF_CAGE 40 11 4}
    {WOLF_CAGE 37 10 4}
    {WOLF_CAGE 41 10 4}
    {WOLF_CAGE 38 8 4}
    {WOLF_CAGE 40 8 4}

    #villages

    {STARTING_VILLAGES_ALL 4}
    {STARTING_VILLAGES 1 1}

    [event]
    name=start

        [message]
        speaker=Mursha
        message= _"We finally made it to the Dead Oak stronghold. Looks like they're still recovering from the flood!"
        [/message]

        #Фермы

        [scroll_to]
            x,y=39,26
        [/scroll_to]

        {FARM_OGRE_ANIM 41 24 40 24}

        [delay]
        time=200
        [/delay]

        {FARM_OGRE_ANIM 37 27 36 26}

        #Лесопилка

        [scroll_to]
            x,y=17,13
        [/scroll_to]

        {CUT_OGRE_ANIM 18 10 18 9}

        [delay]
        time=200
        [/delay]

        {CUT_OGRE_ANIM 13 11 13 10}

        #Замок

        [scroll_to]
            x,y=36,14
        [/scroll_to]

        {BUILD_OGRE_ANIM 35 11 34 11}

        {MOVE_UNIT x,y=35,12 34 11}

        [delay]
        time=200
        [/delay]

        {BUILD_OGRE_ANIM 42 12 43 13}

        {MOVE_UNIT x,y=43,12 43 13}

        [message]
        speaker=Bastard
        message= _"When we left the Alliance war, this bastard Turge wouldn't let us rest in his fortress. I'm glad the river spirits punished him."
        [/message]
        [message]
        speaker=Slaver_Main
        message= _"As if the war and the flood weren't enough! Who are you, why are you leading an army into my land?"
        [/message]
        [message]
        speaker=Bastard
        message= _"<span size='small'><i>What should I answer him?</i></span>"
        [/message]
        [message]
        speaker=Mursha
        message= _"<span size='small'><i>Introduce yourself and say you wish to challenge his authority over the ogres.</i></span>"
        [/message]
        [message]
        speaker=Bastard
        message= _"I am Moog the Harmful. Chief of the Cold Blood clan. I want... You don't have to rule the ogres. I will."
        [/message]
        [message]
        speaker=Slaver_Main
        message= _"Cold Blood? I believe you were one of the first to sneak out of the war with your heels blazing? Ha-ha! And on what grounds do you, leader of weaklings and cowards, challenge me?"
        [/message]
        [message]
        speaker=Mursha
        message= _"<span size='small'><i>Tell him it was the Cold Blood who defeated the ogres.</i></span>"
        [/message]
        [message]
        speaker=Bastard
        message= _"The Cold Blood clan defeated the ogres in the past, and you took all the ogres for yourself. The Cold Blood have the right to take some of the ogres for themselves!"
        [/message]
        [message]
        speaker=Slaver_Main
        message= _"Pfft, bullshit! That should have been decided by those who ruled the clans at the time. I became chief when the ogres were already in the Dead Oak's domain, and I don't care what happened decades ago! I will not give up on them. If you want to buy slaves, pay 50 gold pieces each, or get lost!"
        [/message]
        [message]
        speaker=Mursha
        message= _"<span size='small'><i>Tell him about your blood.</i></span>"
        [/message]
        [message]
        speaker=Bastard
        message= _"Listen up, asshole. I have the blood of the Khan of the Ogres in me. I am his heir, I will not buy my subjects, I will set them free!"
        [/message]
        [message]
        speaker=Slaver_Main
        message= _"Khan of the Ogres? Ha ha! Maybe it's not so bad that you came to me, I just need more slaves. Soon you will be reunited with your people, Khan of the Ogres, and you all will serve me until you die!"
        [/message]
        [message]
        speaker=Bastard
        message= _"You will pay for those words, scum."
        [/message]

        #ogres

        [message]
        x,y=39,22
        message=_ "Master, water has turned the field into mud. Mine is sinking. Mine can't work like that, Master."
        [/message]
        [message]
        speaker=Slaver_Farm
        message=_ "Shut up and work, animal! Chief says we need to grow bread and exchange it for weapons as soon as possible!"
        [/message]

        [sound]
        name=tail.ogg
        [/sound]

        [sound]
        name=mud-glob.ogg
        [/sound]

        [kill]
        x,y=39,22
        animate=yes
        [/kill]
        [unit]
        side=5
        role=rebel2
        type=Mudogre
        x,y=39,22
        animate=yes
        [/unit]

        [scroll_to]
            x,y=17,13
        [/scroll_to]

        {CUT_OGRE_ANIM 16 10 16 9}

        [message]
        speaker=Slaver_Wood
        message=_ "Cut down the forest faster, assholes! Chief said we need to repair the fortress as soon as possible!"
        [/message]
        [message]
        speaker=First_Rebel
        message=_ "Ogres work from morning to night without rest, Master. The ogres are tired, can't work!"
        [/message]
        [message]
        speaker=Slaver_Wood
        message=_ "You're wasting your energy talking?! Punisher, help him do his job!"
        [/message]

        {MOVE_UNIT id=Deputy 18 12}

        [sound]
        name=tail.ogg
        [/sound]

        {ANIMATE_ATTACK Deputy 17,12 sword no}
       
        {ANIMATE_ATTACK First_Rebel 18,12 cleaver yes}
        {KILL Deputy yes}

        [message]
        speaker=First_Rebel
        message=_ "Ogres will no longer be slaves. We know the Khan of the Ogres has come to free us. We will help Khan kill the evil orcs!"
        [/message]
        [message]
        speaker=Slaver_Wood
        message=_ "Shit! Chief, my slaves have risen!"
        [/message]
        [message]
        speaker=Slaver_Farm
        message=_ "Mine too! What do we do!?"
        [/message]
        [message]
        speaker=Slaver_Main
        message=_ "Idiots! Put down the rebellion, kill the rebels! I'll take care of bastard Moog."
        [/message]
        [message]
        speaker=Mursha
        message=_ "This is our chance! Ogres see you as their Khan, Moog. Help their rebellion, and then they will join you!"
        [/message]

        #Задания

        [objectives]
              silent=no
                [objective]
                    description= _ "Kill the Dead Oak Wardens"
                    condition=win
                [/objective]
                [objective]
                    description= _ "The Death of 7 rebel ogres ($dead_ogres|/7)"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Moog"
                    condition=lose
                [/objective]
                 [objective]
                    description= _ "Death of Mursha"
                    condition=lose
                [/objective]
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                [/gold_carryover]
                [note]
                    description=_"When you kill the Warden, the ogres he oversaw will join to your side."
                [/note]
                delayed_variable_substitution=yes
        [/objectives]    
    [/event]

    #Дальше пропишу переход огров на сторону игрока, затем - условия поражения

    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Farm 2 1 38 19}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Farm 2 2 32 22}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Farm 2 3 27 27}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Farm 2 4 25 31}

    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Wood 3 1 26 9}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Wood 3 2 23 13}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Wood 3 3 14 16}
    {SCENARIO_4_CAGE_CONDITIONAL Slaver_Wood 3 4 9 17}

    [event]
    name=turn_2
    first_time_only=no

    {VARIABLE_OP gates add 1}

    [/event]

    [event]
    name=side_4_turn
    first_time_only=no
    id=gates_open

    [if]
    [variable]
        name=gates
        numerical_equals=1
    [/variable]
    [then]
        [sound]
        name=flail-miss.ogg
        [/sound]
        [delay]
        time=100
        [/delay]
        [sound]
        name=open-chest.wav
        [/sound]

        {MODIFY_TERRAIN Re^Pw\o 36 13}
        {MODIFY_TERRAIN Re^Pw\o 37 14}
        {MODIFY_TERRAIN Re^Pw\o 38 14}

        [redraw][/redraw]
    [/then]
        [else]
        [/else]
    [/if]
    [/event]
    [event]
    name=side_4_turn_end
    first_time_only=no
    id=gates_closed

    [if]
    [variable]
        name=gates
        numerical_equals=1
    [/variable]
    [then]

        [sound]
        name=flail-miss.ogg
        [/sound]
        [delay]
        time=100
        [/delay]
        [sound]
        name=open-chest.wav
        [/sound]

        {MOVE_UNIT x,y=36,13 35 14}
        {MOVE_UNIT x,y=37,14 36 14}
        {MOVE_UNIT x,y=38,14 37 15}

        {MODIFY_TERRAIN Re^Pw\ 36 13}
        {MODIFY_TERRAIN Re^Pw\ 37 14}
        {MODIFY_TERRAIN Re^Pw\ 38 14}

        [redraw][/redraw]
    [/then]
    [else]
    [/else]
    [/if]
    [/event]
    [event]
    name=die
    first_time_only=no

        [filter]
        id=Slaver_Wood
        [/filter]

        [message]
        role=rebel1
        message= _"Khan helped us! We'll cut down orcs like trees!"
        [/message]

        [modify_unit]
        [filter]
            role=rebel1
        [/filter]
            side=1
            attacks_left=1
            moves=5
        [/modify_unit]

            [if]
                [variable]
                name=open_cages2
                numerical_equals=3
                [/variable]
            [then]
            [/then]
            [else]
            [if]
                [have_unit]
                id=Slaver_Farm
                [/have_unit]
            [then]
                [message]
                speaker=Bastard
                message=_ "There are wolves left in the cages of this warden. Let's feed them the corpses of these freaks and take them for ourselves!"
                [/message]

                {REMOVE_CAGE 9 17}
                {REMOVE_CAGE 14 16}
                {REMOVE_CAGE 23 13}
                {REMOVE_CAGE 26 9}

                [message]
                speaker=narrator
                image=wesnoth-icon.png
                message=_ "Now you can recruit wolves!"
                [/message]

                [allow_recruit]
                side=1
                type=Wolf
                [/allow_recruit]

                [set_variable]
                name=has_wolves
                value=1
                [/set_variable]

            [/then]
            [else]

                {REMOVE_CAGE 9 17}
                {REMOVE_CAGE 14 16}
                {REMOVE_CAGE 23 13}
                {REMOVE_CAGE 26 9}

            [/else]
            [/if]
            [/else]
        [/if]
        {VARIABLE_OP saved_ogres add 1}
        {ALL_SAVED}
    [/event]
    [event]
    name=die
    first_time_only=no

        [filter]
        id=Slaver_Farm
        [/filter]

        [message]
        role=rebel2
        message= _"Khan helped us! No more digging in the dirt!"
        [/message]

        [modify_unit]
        [filter]
        role=rebel2
        [/filter]
        side=1
        attacks_left=1
        moves=5
        [/modify_unit]

    [if]
            [variable]
            name=open_cages3
            numerical_equals=3
            [/variable]
    [then]
    [/then]
        [else]
            [if]

            [have_unit]
            id=Slaver_Wood
            [/have_unit]

        [then]

            [message]
            speaker=Bastard
            message=_ "There are wolves left in the cages of this warden. Let's feed them the corpses of these freaks and take them for ourselves!"
            [/message]

            {REMOVE_CAGE 25 31}
            {REMOVE_CAGE 27 27}
            {REMOVE_CAGE 32 22}
            {REMOVE_CAGE 38 19}    

            [message]
            speaker=narrator
            message=_ "Now you can recruit wolves!"
            [/message]

            [allow_recruit]
            side=1
            type=Wolf
            [/allow_recruit]
            [set_variable]
            name=has_wolves
            value=1
            [/set_variable]

        [/then]
        [else]
            {REMOVE_CAGE 25 31}
            {REMOVE_CAGE 27 27}
            {REMOVE_CAGE 32 22}
            {REMOVE_CAGE 38 19}    
        [/else]
        [/if]
        [/else]
        [/if]

        {VARIABLE_OP saved_ogres add 1}
        {ALL_SAVED}
    [/event]

    #Теперь условие опускания ворот и мятежа внутри крепости

    [event]
    name=moveto
    first_time_only=no
      
        [filter]
            side=1
            race=ogre
            [not]
            role=movedogre
            [/not]
            [filter_location]
                x,y=36,14
                radius=2
            [/filter_location]
        [/filter]

        {VARIABLE_OP rebellion add 1}

        [modify_unit]
        [filter]
        x,y=$unit.x,$unit.y
        [/filter]
        role=movedogre
        [/modify_unit]

        [if]
        [variable]
            name=rebellion
            numerical_equals=5
        [/variable]

        [then]

        [message]
        role=movedogre
        message= _"Khan has freed us and come for you! All ogres will be free!"
        [/message]
        [message]
        role=treator
        message= _"Open the gates to Khan, kill the evil orcs!"
        [/message]
        
        {REMOVE_IMAGE 36 14}
        {REPLACE_SCENARIO_MUSIC the_city_falls.ogg}
        {APPEND_MUSIC frantic.ogg}
        {APPEND_MUSIC battle-epic.ogg}
        {APPEND_MUSIC legends_of_the_north.ogg}

        [modify_unit]
        [filter]
            role=treator
        [/filter]
            side=5
        [/modify_unit]

        [scroll_to]
            x,y=36,14
        [/scroll_to]

        [sound]
        name=flail-miss.ogg
        [/sound]
        [delay]
        time=100
        [/delay]
        [sound]
        name=flail-miss.ogg
        [/sound]
        [delay]
        time=100
        [/delay]
        [sound]
        name=flail-miss.ogg
        [/sound]
        [delay]
        time=100
        [/delay]

        {QUAKE ""}

        [sound]
        name=wose-die.ogg
        [/sound]
        [sound]
        name=open-chest.wav
        [/sound]
        [sound]
        [sound]
        name=open-chest.wav
        [/sound]
        name=wose-die.ogg
        [/sound]
        [sound]
        name=open-chest.wav
        [/sound]
        [sound]
        name=wose-die.ogg
        [/sound]

        {MODIFY_TERRAIN Re^Pw\o 36 13}
        {MODIFY_TERRAIN Re^Pw\o 37 14}
        {MODIFY_TERRAIN Re^Pw\o 38 14}

        [redraw][/redraw]

        [delay]
        time=1500
        [/delay]

        [message]
        speaker=Slaver_Main
        message= _"Damn it! Everybody to the gate! Stop them!"
        [/message]

        #ogres

        [store_unit]
            [filter]
                side=5
                race=ogre
                [filter_wml]
                    max_moves=0
                [/filter_wml]
            [/filter]
            variable=ogre_guards
        [/store_unit]
        [foreach]
            array=ogre_guards
            index_var=i
            [do]
                [unstore_unit]
                    variable=this_item
                [/unstore_unit]
                [remove_object]
                    id=$this_item.id
                    object_id=zero_moves_ogres
                [/remove_object]
            [/do]
        [/foreach]
        
        #orcs

        [store_unit]
            [filter]
                side=4
                race=orc
                [filter_wml]
                    max_moves=0
                [/filter_wml]
            [/filter]
            variable=orc_guards
        [/store_unit]
        [foreach]
            array=orc_guards
            index_var=i
            [do]
                [unstore_unit]
                    variable=this_item
                    text=_ "Charge!"
                    {COLOR_HARM} 
                [/unstore_unit]
                [remove_object]
                    id=$this_item.id
                    object_id=zero_moves_orcs
                [/remove_object]
            [/do]
        [/foreach]
        [fire_event]
            name=open_all_cages4
        [/fire_event]
        
        [objectives]
              silent=no
                [objective]
                    description= _ "Kill Turge the Enslaver"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Moog"
                    condition=lose
                [/objective]
                 [objective]
                    description= _ "Death of Mursha"
                    condition=lose
                [/objective]
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                [/gold_carryover]
        [/objectives] 
        
        {CLEAR_VARIABLE rebellion}
        {CLEAR_VARIABLE dead_ogres}

        [gold]
        side=4
        #ifdef EASY
            amount=56
        #endif
        #ifdef NORMAL
            amount=70
        #endif
        #ifdef HARD
            amount=84
        #endif
        [/gold]

        [remove_event]
            id=gates_open
        [/remove_event]
        [remove_event]
            id=gates_closed
        [/remove_event]
        [remove_event]
            id=ogres_die
        [/remove_event]

        [/then]
        [else]
        [/else]
        [/if]
    [/event]

    [event]
    name=last_breath

        [filter]
        id=Slaver_Main
        [/filter]

        [message]
        speaker=Slaver_Main
        message= _"No! No way! Bastard Moog! Damn you and your ogres!"
        [/message]
        [message]
        speaker=Bastard
        message= _"You wanted to make me a slave, you scum. Let your slaves decide your fate!"
        [/message]
        [message]
        race=ogre
        message= _"The Great Khan! Let us eat the evil chief and kill all his orcs!"
        [/message]
        [message]
        speaker=Mursha
        message= _"At least tell them to leave the goblins and the weaklings out of it. They can join to your-"
        [/message]
        [message]
        speaker=Bastard
        message= _"Do whatever you want to do with them!"
        [/message]

        {QUAKE "dwarf-laugh.wav"}
      
        [kill]
        side=4
        animate=yes
        [/kill]

        [message]
        speaker=Mursha
        message= _"Thank the spirits, we won. But it was too dangerous to storm the fortress. You mustn't take that risk."
        [/message]
        [message]
        speaker=Bastard
        message= _"It was worth it, not only did I free the ogres, but I strengthened my authority among the orcs. Our warriors were happy to storm and pillage the fortress."
        [/message]
        [message]
        speaker=Mursha
        message= _"Yeah, but if you died, everything would be gone..."
        [/message]
        [message]
        speaker=Bastard
        message= _"What everything?"
        [/message]
        [message]
        speaker=Mursha
        message= _"A worthy future for our clan."
        [/message]
        [message]
        speaker=Bastard
        message= _"I don't care what happens after I die. While I was waiting for you and Ka'ah to solve all the problems, I was losing my power. Now I've taken matters into my own hands, and my power has increased. Looks like it's time for me to rule alone."
        [/message]
        [message]
        speaker=Mursha
        message= _"But I'm the one who found out about the Dead Oak lands and suggested this campaign."
        [/message]
        [message]
        speaker=Bastard
        message= _"Yes, but I commanded the army and carried the battle through."
        [/message]
        [message]
        speaker=Mursha
        message= _"What do you mean by that?"
        [/message]
        [message]
        speaker=Bastard
        message= _"Don't try to restrain me like Ka'ah, but rather help me in my endeavors. Since I am chosen by the spirits, I know what to do."
        [/message]
        [message]
        speaker=Mursha
        message= _"Well... All right."
        [/message]

        [unit]
        side=5
        type=Direwolf Rider
        name=_ "Black Eye's messenger"
        id=King_Messenger
        [modifications]
            [object]
                [effect]
                    apply_to=image_mod
                    add=RC(magenta>black)
                [/effect]
            [/object]
        [/modifications]
        x,y=1,32
        animate=no
        [/unit]
        {MOVE_UNIT id=King_Messenger 7 30}

        [unit]
        side=5
        type=Goblin Knight
        [modifications]
            [object]
                [effect]
                    apply_to=image_mod
                    add=RC(magenta>black)
                [/effect]
            [/object]
        [/modifications]
        x,y=1,32
        animate=no
        [/unit]

        {MOVE_UNIT x,y=1,32 7 30}

        [unit]
        side=5
        type=Goblin Knight
        [modifications]
            [object]
                [effect]
                    apply_to=image_mod
                    add=RC(magenta>black)
                [/effect]
            [/object]
        [/modifications]
        x,y=1,32
        animate=no
        [/unit]

        {MOVE_UNIT x,y=1,32 7 30}
    
        [message]
        speaker=King_Messenger
        message=_ "In the name of the Supreme Leader, stop the war! or the wrath of Black Eye will fall upon you!"
        [/message]
        [message]
        speaker=Mursha
        message= _"<span size='small'><i>It's the riders from Barag-Gor!</i></span>"
        [/message]
        [message]
        speaker=Bastard
        message=_ "The war is already ended with the Cold Blood victory."
        [/message]
        [message]
        speaker=King_Messenger
        message=_ "It doesn't matter. You're the leader of the Cold Blood?"
        [/message]
        [message]
        speaker=Bastard
        message=_ "Yes."
        [/message]
        [message]
        speaker=King_Messenger
        message=_ "Then you must come with us to Barag-Gor. The Supreme Leader is calling you."
        [/message]
        [message]
        speaker=Bastard
        message=_ "What's he want from me?"
        [/message]
        [message]
        speaker=King_Messenger
        message=_ "I don't know, but refusal would be considered an offense to his authority over the orcs!"
        [/message]
        [message]
        speaker=Mursha
        message= _"<span size='small'><i>It's most likely related to our campaign. You can't say no to them. Go to Barag-Gor, do not be afraid, do not try to deceive the Supreme Leader. Speak the truth, be honorable. And I will take our army to our citadel.</i></span>"
        [/message]
        [message]
        speaker=Bastard
        message=_ "Uh, okay, I'll go to Barag-Gor with you."
        [/message]

        [endlevel]
        result=victory
        [/endlevel]
    [/event]

    {MOOG_MURSHA_DEATH}
    {PET_EVENTS}

    [event]
    name=die
    id=ogres_die
    first_time_only=no

        [filter]
            side=5
            race=ogre
            [or]
                side=1
                race=ogre
            [/or]
        [/filter]

        {VARIABLE_OP dead_ogres add 1}

        [if]
            [variable]
                name=dead_ogres
                numerical_equals=7
            [/variable]
        [then]

        [message]
            speaker=Bastard
            message=_ "Most of the ogres are dead. Now I have nowhere to get a loyal guard!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]

        {CLEAR_VARIABLE dead_ogres}

        [/then]
            [else]
            [/else]
        [/if]
    [/event]

    [event]
    name=moveto
    first_time_only=no

        [filter]
            role=movedogre
            [filter_location]
            [not]
            x,y=36,14
            radius=3
            [/not]
            [/filter_location]
            [/filter]
            [modify_unit]
                [filter]
                    id=$unit.id
                [/filter]
                role=
            [/modify_unit]
    
    {VARIABLE_OP rebellion sub 1}
    [/event]
[/scenario]
